<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mijn contracten | Overzicht maandelijkse kosten</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Contracten">
    <link rel="apple-touch-icon" href="https://iili.io/fUPOeet.png">
    <link rel="icon" type="image/x-icon" href="https://iili.io/fUPOeet.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#001D3D">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        
        /* === BASISINSTELLINGEN === */
        :root {
            --primary-color: #001D3D;
            --primary-light: #0B1A2D;
            --accent-color: #3B82F6;
            --background-color: #F8FAFC;
            --text-primary: #0F172A;
            --text-secondary: #64748B;
            --text-muted: #94A3B8;
            --border-color: #E2E8F0;
            --success-color: #10B981;
            --danger-color: #EF4444;
            --warning-color: #F59E0B;
        }

        /* === TYPOGRAFIE === */
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            font-weight: 500;
        }

        .heading-xl {
            font-size: 2rem;
            font-weight: 800;
            letter-spacing: -0.025em;
            line-height: 1.2;
        }

        .heading-lg {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.015em;
        }

        .total-label {
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.05em; /* Minder letterafstand */
            text-transform: uppercase;
            opacity: 0.6;
        }

        .total-amount {
            font-size: 2.5rem;
            font-weight: 900;
            letter-spacing: -0.05em;
        }

        .label-small {
            font-size: 0.625rem;
            font-weight: 700;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        /* === COMPONENTEN === */
        .card-rounded {
            border-radius: 32px;
        }

        .card-rounded-lg {
            border-radius: 40px;
        }

        .button-rounded {
            border-radius: 24px;
        }

        .input-rounded {
            border-radius: 20px;
        }

        /* === ANIMATIES === */
        .scrollbar-hide::-webkit-scrollbar { 
            display: none; 
        }

        @keyframes slideInUp {
            from { 
                transform: translateY(100%); 
                opacity: 0; 
            }
            to { 
                transform: translateY(0); 
                opacity: 1; 
            }
        }

        .animate-sheet { 
            animation: slideInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); 
        }

        /* === INTERACTIES === */
        .clickable {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .clickable:hover {
            opacity: 0.8;
        }

        .clickable:active {
            transform: scale(0.98);
        }

        /* === SCROLL CONTAINER === */
        .scroll-container {
            cursor: grab;
            user-select: none;
        }

        .scroll-container:active {
            cursor: grabbing;
        }

        /* === SCHADUWEN === */
        .shadow-card {
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
        }

        .shadow-card-hover {
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        .shadow-total-card {
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
        }
    </style>
</head>
<body class="bg-[#F8FAFC]">
    <div id="root"></div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(err => console.log('SW error', err));
            });
        }

        const e = React.createElement;
        const { useState, useMemo, useEffect, useRef } = React;

        const Icon = ({ name, size = 18, className = "", fill = "none" }) => 
            e('i', { 'data-lucide': name, className, style: { width: size, height: size, strokeWidth: 2, display: 'inline-block', fill } });

        // Hook voor drag-to-scroll functionaliteit
        const useDragScroll = () => {
            const ref = useRef(null);
            const [isDragging, setIsDragging] = useState(false);
            const [startX, setStartX] = useState(0);
            const [scrollLeft, setScrollLeft] = useState(0);

            useEffect(() => {
                const el = ref.current;
                if (!el) return;

                const handleMouseDown = (e) => {
                    setIsDragging(true);
                    setStartX(e.pageX - el.offsetLeft);
                    setScrollLeft(el.scrollLeft);
                };

                const handleMouseLeave = () => setIsDragging(false);
                const handleMouseUp = () => setIsDragging(false);

                const handleMouseMove = (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                    const x = e.pageX - el.offsetLeft;
                    const walk = (x - startX) * 2;
                    el.scrollLeft = scrollLeft - walk;
                };

                el.addEventListener('mousedown', handleMouseDown);
                el.addEventListener('mouseleave', handleMouseLeave);
                el.addEventListener('mouseup', handleMouseUp);
                el.addEventListener('mousemove', handleMouseMove);

                return () => {
                    el.removeEventListener('mousedown', handleMouseDown);
                    el.removeEventListener('mouseleave', handleMouseLeave);
                    el.removeEventListener('mouseup', handleMouseUp);
                    el.removeEventListener('mousemove', handleMouseMove);
                };
            }, [isDragging, startX, scrollLeft]);

            return ref;
        };

        const App = () => {
            const filterScrollRef = useDragScroll();
            
            const [contracts, setContracts] = useState(() => {
                const saved = localStorage.getItem('pwa_contracts_v3');
                return saved ? JSON.parse(saved) : [];
            });

            const [searchQuery, setSearchQuery] = useState('');
            const [activeFilter, setActiveFilter] = useState('All');
            const [statusFilter, setStatusFilter] = useState('active');
            const [viewMode, setViewMode] = useState('monthly');
            const [selectedContract, setSelectedContract] = useState(null);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isEditing, setIsEditing] = useState(false);
            const [formData, setFormData] = useState({ name: '', provider: '', type: '', cost: '', frequency: 'monthly' });

            useEffect(() => { lucide.createIcons(); });
            useEffect(() => { localStorage.setItem('pwa_contracts_v3', JSON.stringify(contracts)); }, [contracts]);

            const getMonthlyCost = (c) => {
                const cost = parseFloat(c.cost || 0);
                if (c.frequency === 'yearly') return cost / 12;
                if (c.frequency === 'quarterly') return cost / 3;
                return cost;
            };

            const stats = useMemo(() => {
                const active = contracts.filter(c => c.status === 'active');
                const totalMonthly = active.reduce((acc, curr) => acc + getMonthlyCost(curr), 0);
                const subscriptionTotal = active.filter(c => c.type === 'Subscription').reduce((acc, curr) => acc + getMonthlyCost(curr), 0);
                const expensive = active.length > 0 ? [...active].sort((a, b) => getMonthlyCost(b) - getMonthlyCost(a))[0] : null;
                return { totalMonthly, expensive, subscriptionTotal, count: active.length };
            }, [contracts]);

            const filteredContracts = useMemo(() => {
                return contracts
                    .filter(c => (statusFilter === 'active' ? c.status !== 'archived' : c.status === 'archived'))
                    .filter(c => c.name.toLowerCase().includes(searchQuery.toLowerCase()) || (c.provider && c.provider.toLowerCase().includes(searchQuery.toLowerCase())))
                    .filter(c => activeFilter === 'All' || c.type === activeFilter);
            }, [contracts, searchQuery, activeFilter, statusFilter]);

            const getTypeLabel = (t) => ({ Housing: 'Wonen', Insurance: 'Verzekering', Subscription: 'Abonnement', Utilities: 'Nutsvoorziening', Other: 'Overig' }[t] || t);

            const getIconColorClass = (type) => {
                switch(type) {
                    case 'Insurance': return 'bg-emerald-50 text-emerald-600';
                    case 'Housing': return 'bg-orange-50 text-orange-600';
                    case 'Subscription': return 'bg-indigo-50 text-indigo-600';
                    default: return 'bg-blue-50 text-blue-600';
                }
            };

            const openAddModal = () => {
                setIsEditing(false);
                setFormData({ name: '', provider: '', type: '', cost: '', frequency: 'monthly' });
                setIsModalOpen(true);
            };

            return e('div', { className: "min-h-screen bg-[#F8FAFC] pb-12 selection:bg-blue-100" },
                e('header', { className: "bg-white px-6 pt-12 pb-8 shadow-sm card-rounded-lg" },
                    e('div', { className: "max-w-md mx-auto" },
                        e('div', { className: "flex justify-between items-center mb-6" },
                            e('div', null,
                                e('h1', { className: "heading-xl text-[#001D3D]" }, "Mijn contracten"),
                                e('p', { className: "text-slate-400 text-sm font-medium" }, "Snel overzicht van je kosten")
                            ),
                            e('div', { className: "bg-blue-50 p-2 rounded-full text-blue-600" }, e(Icon, { name: 'check-circle-2', size: 24 }))
                        ),
                        e('div', { className: "bg-[#0B1A2D] card-rounded p-8 text-white relative overflow-hidden shadow-total-card" },
                            e('div', { className: "absolute -right-10 -top-10 w-40 h-40 bg-blue-500/10 rounded-full blur-3xl" }),
                            e('div', { className: "relative z-10" },
                                e('div', { className: "flex justify-between items-center mb-2" },
                                    e('p', { className: "total-label" }, `Totaal per ${viewMode === 'monthly' ? 'maand' : 'jaar'}`),
                                    e('button', { onClick: () => setViewMode(viewMode === 'monthly' ? 'yearly' : 'monthly'), className: "bg-white/10 hover:bg-white/20 transition px-3 py-1 rounded-full text-[10px] font-bold uppercase" }, `Toon per ${viewMode === 'monthly' ? 'jaar' : 'maand'}`)
                                ),
                                e('div', { className: "flex items-center gap-2" },
                                    e('h2', { className: "total-amount" }, `€${(viewMode === 'monthly' ? stats.totalMonthly : stats.totalMonthly * 12).toLocaleString('nl-BE', { minimumFractionDigits: 2 })}`),
                                    
                                ),
                                e('div', { className: "mt-6 flex items-center gap-4 border-t border-white/10 pt-4" },
                                    e('div', null, e('p', { className: "label-small opacity-50" }, "Aantal"), e('p', { className: "text-sm font-bold" }, `${stats.count} contracten`))
                                )
                            )
                        )
                    )
                ),

                e('main', { className: "max-w-md mx-auto px-6 -mt-4" },
                    e('section', { className: "mb-6" },
                        e('div', { 
                            className: `bg-blue-50 border border-blue-100 p-4 rounded-2xl flex gap-3 items-center ${contracts.length === 0 ? 'clickable' : ''}`,
                            onClick: contracts.length === 0 ? openAddModal : undefined
                        },
                            e('div', { className: "bg-blue-600/10 p-2.5 rounded-xl text-blue-600" }, e(Icon, { name: 'zap', size: 18, fill: "currentColor" })),
                            e('div', { className: "flex-1 text-left" },
                                e('p', { className: "text-xs text-blue-900 leading-snug" }, 
                                    stats.expensive 
                                    ? e('span', null, 
                                        'Je grootste uitgave is ',
                                        e('strong', { className: "font-extrabold" }, stats.expensive.name),
                                        `. Abonnementen kosten je €${stats.subscriptionTotal.toLocaleString('nl-BE', { minimumFractionDigits: 2 })} per maand.`
                                      )
                                    : e('strong', { className: "font-bold" }, "Voeg je eerste contract toe.")
                                )
                            )
                        )
                    ),

                    e('section', { className: "space-y-4 mb-6" },
                        e('div', { className: "relative group" },
                            e(Icon, { name: 'search', className: "absolute left-4 top-1/2 -translate-y-1/2 text-slate-400", size: 18 }),
                            e('input', { type: 'text', placeholder: "Zoek op naam, aanbieder...", className: "w-full bg-white border border-slate-200 input-rounded py-4 pl-12 pr-4 text-sm font-medium shadow-sm focus:outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-200 transition-all", value: searchQuery, onChange: (ev) => setSearchQuery(ev.target.value) })
                        ),
                        e('div', { ref: filterScrollRef, className: "flex gap-2 overflow-x-auto pb-2 scrollbar-hide scroll-container" },
                            ['All', 'Housing', 'Insurance', 'Subscription', 'Utilities', 'Other'].map(t => 
                                e('button', { key: t, onClick: () => setActiveFilter(t), className: `px-5 py-2.5 rounded-full text-xs font-bold whitespace-nowrap border shrink-0 transition-all ${activeFilter === t ? 'bg-[#001D3D] text-white border-[#001D3D] shadow-lg' : 'bg-white text-slate-500 border-slate-200'}` }, t === 'All' ? 'Alles' : getTypeLabel(t))
                            )
                        ),
                        e('div', { className: "flex items-center justify-between px-1" },
                            e('div', { className: "flex bg-slate-200/50 p-1 rounded-xl" },
                                ['active', 'archived'].map(s => e('button', { key: s, onClick: () => setStatusFilter(s), className: `px-3 py-1.5 rounded-lg label-small transition-all ${statusFilter === s ? 'bg-white text-slate-900 shadow-sm' : 'text-slate-500'}` }, s === 'active' ? 'Actief' : 'Archief'))
                            ),
                            e('button', { onClick: openAddModal, className: "text-blue-600 font-bold text-xs flex items-center gap-1 hover:bg-blue-50 px-3 py-2 rounded-xl transition" }, e(Icon, { name: 'plus', size: 16 }), "Toevoegen")
                        )
                    ),

                    e('section', { className: "space-y-3" },
                        filteredContracts.map((contract) => 
                            e('div', { key: contract.id, onClick: () => setSelectedContract(contract), className: "bg-white p-4 rounded-[24px] border border-slate-100 shadow-card hover:shadow-card-hover transition-all active:scale-[0.98] cursor-pointer flex items-center gap-4" },
                                e('div', { className: `w-12 h-12 rounded-2xl flex items-center justify-center shrink-0 ${getIconColorClass(contract.type)}` }, e(Icon, { name: contract.type === 'Housing' ? 'home' : contract.type === 'Insurance' ? 'shield' : contract.type === 'Utilities' ? 'zap' : 'credit-card' })),
                                e('div', { className: "flex-1 min-w-0 text-left" },
                                    e('h4', { className: "font-bold text-sm text-slate-900 truncate" }, contract.name),
                                    e('p', { className: "label-small text-slate-400" }, contract.provider || 'Geen aanbieder')
                                ),
                                e('div', { className: "text-right shrink-0" },
                                    e('p', { className: "font-extrabold text-[15px] text-slate-900" }, `€${getMonthlyCost(contract).toLocaleString('nl-BE', { minimumFractionDigits: 2 })}`),
                                    e('p', { className: "text-[9px] text-slate-400 font-bold uppercase tracking-tighter" }, "per maand")
                                ),
                                e(Icon, { name: 'chevron-right', size: 16, className: "text-slate-300" })
                            )
                        )
                    )
                ),

                isModalOpen && e('div', { className: "fixed inset-0 bg-[#001D3D]/60 backdrop-blur-md z-[60] flex items-end justify-center p-4" },
                    e('form', { 
                        onSubmit: (ev) => {
                            ev.preventDefault();
                            if (!formData.type) {
                                alert('Selecteer een type');
                                return;
                            }
                            if (isEditing) setContracts(contracts.map(c => c.id === formData.id ? formData : c));
                            else setContracts([...contracts, { ...formData, id: Date.now(), status: 'active' }]);
                            setIsModalOpen(false);
                        },
                        className: "bg-white w-full max-w-md card-rounded-lg p-8 shadow-2xl animate-sheet max-h-[90vh] overflow-y-auto text-left" 
                    },
                        e('div', { className: "flex justify-between items-center mb-6" }, 
                            e('h2', { className: "heading-lg text-[#001D3D]" }, isEditing ? 'Contract bewerken' : 'Nieuw contract'), 
                            e('button', { type: 'button', onClick: () => setIsModalOpen(false), className: "p-2 bg-slate-50 text-slate-400 rounded-full" }, e(Icon, { name: 'x', size: 20 }))
                        ),
                        e('div', { className: "space-y-4" },
                            e('div', null, 
                                e('label', { className: "label-small text-slate-400 ml-2 mb-1 block" }, "Naam"), 
                                e('input', { required: true, className: "w-full bg-slate-50 rounded-2xl py-4 px-5 text-sm font-bold border-none", value: formData.name, onChange: ev => setFormData({...formData, name: ev.target.value}) })
                            ),
                            e('div', null, 
                                e('label', { className: "label-small text-slate-400 ml-2 mb-1 block" }, "Aanbieder"), 
                                e('input', { className: "w-full bg-slate-50 rounded-2xl py-4 px-5 text-sm font-bold border-none", value: formData.provider, onChange: ev => setFormData({...formData, provider: ev.target.value}) })
                            ),
                            e('div', { className: "grid grid-cols-2 gap-4" },
                                e('div', null, 
                                    e('label', { className: "label-small text-slate-400 ml-2 mb-1 block" }, "Type"), 
                                    e('select', { 
                                        required: true,
                                        className: "w-full bg-slate-50 rounded-2xl py-4 px-5 text-sm font-bold border-none appearance-none", 
                                        value: formData.type, 
                                        onChange: ev => setFormData({...formData, type: ev.target.value}) 
                                    }, 
                                        e('option', { value: '', disabled: true }, 'Selecteer'),
                                        ['Subscription', 'Insurance', 'Housing', 'Utilities', 'Other'].map(opt => e('option', { key: opt, value: opt }, getTypeLabel(opt)))
                                    )
                                ),
                                e('div', null, 
                                    e('label', { className: "label-small text-slate-400 ml-2 mb-1 block" }, "Bedrag (€)"), 
                                    e('input', { type: 'number', step: '0.01', required: true, className: "w-full bg-slate-50 rounded-2xl py-4 px-5 text-sm font-bold border-none", value: formData.cost, onChange: ev => setFormData({...formData, cost: ev.target.value}) })
                                )
                            ),
                            e('div', null, 
                                e('label', { className: "label-small text-slate-400 ml-2 mb-1 block" }, "Frequentie"), 
                                e('div', { className: "flex bg-slate-100 p-1 rounded-2xl" }, 
                                    ['monthly', 'quarterly', 'yearly'].map(f => 
                                        e('button', { 
                                            key: f, 
                                            type: 'button', 
                                            onClick: () => setFormData({...formData, frequency: f}), 
                                            className: `flex-1 py-3 rounded-xl text-xs font-bold transition-all ${formData.frequency === f ? 'bg-white shadow-sm text-blue-600' : 'text-slate-500'}` 
                                        }, f === 'monthly' ? 'Maandelijks' : f === 'quarterly' ? '3-maandelijks' : 'Jaarlijks')
                                    )
                                )
                            ),
                            e('button', { type: 'submit', className: "w-full bg-[#001D3D] text-white py-5 button-rounded font-bold text-lg shadow-xl mt-4 flex items-center justify-center gap-2" }, 
                                e(Icon, { name: 'save', size: 20 }), 
                                isEditing ? 'Wijzigingen opslaan' : 'Contract opslaan'
                            )
                        )
                    )
                ),

                selectedContract && e('div', { className: "fixed inset-0 bg-[#001D3D]/40 backdrop-blur-sm z-50 flex items-end justify-center" },
                    e('div', { className: "bg-white w-full max-w-md rounded-t-[40px] p-8 shadow-2xl animate-sheet text-left" },
                        
                        e('div', { className: "flex justify-between items-start mb-8" },
                            e('div', null, 
                                e('span', { className: "label-small bg-slate-100 text-slate-500 px-2.5 py-1 rounded-lg mb-2 inline-block" }, getTypeLabel(selectedContract.type)), 
                                e('h2', { className: "heading-lg text-[#001D3D] leading-tight" }, selectedContract.name), 
                                e('p', { className: "text-slate-400 font-medium" }, selectedContract.provider || 'Geen aanbieder')
                            ),
                            e('button', { onClick: () => setSelectedContract(null), className: "p-3 bg-slate-50 text-slate-400 rounded-2xl" }, e(Icon, { name: 'x', size: 20 }))
                        ),
                        e('div', { className: "grid grid-cols-2 gap-4 mb-8" },
                            e('div', { className: "bg-slate-50 p-5 rounded-[24px] border border-slate-100" }, 
                                e('p', { className: "label-small text-slate-400 mb-1" }, "Maandelijkse kost"), 
                                e('p', { className: "text-xl font-black text-blue-600" }, `€${getMonthlyCost(selectedContract).toLocaleString('nl-BE', { minimumFractionDigits: 2 })}`)
                            ),
                            e('div', { className: "bg-slate-50 p-5 rounded-[24px] border border-slate-100" }, 
                                e('p', { className: "label-small text-slate-400 mb-1" }, "Facturatie"), 
                                e('p', { className: "text-sm font-bold text-slate-700" }, 
                                    selectedContract.frequency === 'monthly' ? 'Maandelijks' : 
                                    selectedContract.frequency === 'quarterly' ? '3-maandelijks' : 'Jaarlijks'
                                )
                            )
                        ),
                        e('div', { className: "space-y-3" },
                            e('div', { className: "flex gap-3" },
                                e('button', { onClick: () => { 
                                    const updatedContract = {...selectedContract, status: selectedContract.status === 'active' ? 'archived' : 'active'};
                                    setContracts(contracts.map(c => c.id === selectedContract.id ? updatedContract : c)); 
                                    setSelectedContract(null); 
                                }, className: "flex-1 py-4 rounded-2xl font-bold flex items-center justify-center gap-2 bg-slate-100 text-slate-600" }, 
                                    e(Icon, { name: 'archive', size: 18 }), 
                                    selectedContract.status === 'active' ? 'Archiveren' : 'Activeren'
                                ),
                                e('button', { onClick: () => { 
                                    setIsEditing(true); 
                                    setFormData(selectedContract); 
                                    setIsModalOpen(true); 
                                    setSelectedContract(null); 
                                }, className: "flex-1 bg-[#001D3D] text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-2" }, 
                                    e(Icon, { name: 'edit-3', size: 18 }), 
                                    "Bewerken"
                                )
                            ),
                            e('button', { onClick: () => { 
                                setContracts(contracts.filter(c => c.id !== selectedContract.id)); 
                                setSelectedContract(null); 
                            }, className: "w-full bg-red-50 text-red-600 py-4 rounded-2xl font-bold flex items-center justify-center gap-2" }, 
                                e(Icon, { name: 'trash-2', size: 18 }), 
                                "Contract verwijderen"
                            )
                        )
                    )
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(e(App));
    </script>
</body>

</html>



